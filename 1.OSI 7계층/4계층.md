[<<메인으로](https://github.com/AtomicLiquors/Network_Wiki_Chb)

&nbsp;  
&nbsp;  
# 4계층 : 전송 계층 
### *Transport Layer*


데이터 전송 상태가 정상인지 확인하는 역할.  
데이터를 분할해 패킷에 실어보낸다는, 패킷 네트워크의 특성 때문에 필요하다.
- 중간에 패킷이 유실되지 않았는가?
- 패킷 순서가 바뀌지는 않았는가?  
만일 그렇다면 4계층에서 이를 바로잡아준다.
 
&nbsp;

 

"4계층의 목적은 목적지를 찾아가는 주소가 아니라 애플리케이션에서 사용하는 프로세스를 정확히 찾아가는 것" 
  
&nbsp;
### 세션 테이블
세션 정보를 다룬다.
상태 테이블이라고도 하는데 자세한 구분 기준은 다음에 추가하자.


 
&nbsp;
 


### 세션 장비
4계층 이상에서 동작하는 장비를 일컫는 말.

세션 테이블 정보를 이용하여, 
패킷을 변경하거나 애플리케이션 성능을 최적화하고,  
보안을 강화하기 위해 패킷을 전달하거나 드롭시킬 수 있다.

세션 정보는 무제한적으로 저장할 수 없다.  
(적정 메모리 사용률 유지, 과도한 세션을 일으키는 공격 예방)

&nbsp; 

## **TCP**
헤더에 다음 정보를 추가한다.
- 시퀀스 번호 : 패킷에 순서를 부여한다.
- ACK (애크, *ACKnowledgement*) : 패킷에 응답 번호를 부여한다.

두 번호가 상호작용하여 패킷에 이상이 있는지 점검한다.  
(패킷 유실 + 순서 착오)
 
&nbsp;
 

- (p) 포트
 
&nbsp;

 
복잡한 네트워크 상태를 TCP가 많이 커버해 주기 때문에 개발이 훨씬 수월하다.

 
&nbsp;
 

### **TCP의 패킷 교환**
TCP는 일방적으로 패킷을 보내는 게 아니라,  
상대방이 얼마나 잘 받았는지 응답 번호를 확인하고 나서  
다음 패킷을 전송한다.

단 패킷을 한 번 보낼 때마다   
왕복지연시간(RTT, *Round Trip Time*)이 발생하여 응답이 늦어지고,  
거리가 멀수록 더 느려지기 때문에,  
패킷을 한 번 보낼때 한꺼번에 많이 보내고 응답을 한 번만 받는다.  

 
&nbsp;
 
다만 네트워크 상태가 불량하면 패킷 유실 가능성이 커지므로,  
무조건 많이 보내는 게 아니라  
송신량을 적절하게 조절해야 한다.  

- **윈도 사이즈** : 한 번에 받을 수 있는 데이터 크기
- **슬라이딩 윈도** : 윈도 사이즈 조절

 
&nbsp;
 
 
&nbsp;
 
### **3방향 핸드셰이크**
통신 시작 전, 안전 확보를 위한 사전 연결작업.  

목적지 쪽이 준비되지 않은 상태에서 일방적으로 데이터를 보내버리면,  
목적지에서 데이터를 정상 처리할 수 없어 폐기해 버린다.  
통신에 필요한 리소스를 미리 확보하는 작업이 필요하다.

TCP에서는 이를 위하여 목적지와 3번 패킷을 주고받으므로,  
이를 3방향 핸드셰이크라고 부른다.

- LISTEN : 서버가 클라이언트 접속을 받을 수 있는 대기상태. 

- SYN-SENT : 클라이언트가 통신을 시도하기 위해 Syn패킷을 보낸 
상태.  

- SYN-RECEIVE : 서버가 Syn패킷을 받은 상태.  

- ESTABLISHED : 서버-클라이언트 연결이 성공한 상태.  
     1) 클라이언트가 서버로부터 Syn, Ack 응답을 받고,  
     "ESTABLISHED" 상태가 된다.   
     그 후 이를 서버에 통보해 준다.  
    2) 서버는 '클라이언트가 ESTABLISHED 상태가 되었다'는 응답을 받고,  
    마찬가지로 "ESTABLISHED" 상태가 된다.   


&nbsp;  
**플래그** *Flag* :   
3방향 핸드셰이크 통신 과정에서 헤더에 들어가는 구분값.  
0, 1로 구성된 비트 값이다.

동시다발적인 3방향 핸드셰이크 통신들에 대해  
어떤 패킷이 새로운 연결 시도이고,  
어떤 패킷이 기존 통신에 대한 응답인지 구분해 준다.


 
- SYN : 연결 시작을 나타냄
- ACK : ACK 번호가 유효함
- FIN : 정상적인 양방향 연결 종료를 나타냄
- RST : 일방적인 강제 연결 종료를 나타냄
- URG : 긴급 데이터 여부
- PSH : 서버가 전송해 줄 데이터가 없거나,   
버퍼링 없이 응용 프로그램으로 즉시 전달하고자 할 때

&nbsp;

 
&nbsp;
## **UDP**
단방향으로 다수 단말과 통신하여 응답을 받기 어려운 환경에서 사용된다.  
대부분은 음성, 동영상 데이터를 송출하는 경우다.  
(음성 데이터 송출, 실시간 스트리밍, 화상회의, 멀티캐스트...)


일부 데이터가 유실되더라도(영상의 경우 프레임 하나 둘 정도),   
끊김 없는 연결이 더욱 중요한 경우.   

 
&nbsp;
 

UDP는 4계층 프로토콜이 가져야 할 특징이 거의 없다.  
UDP는 중간에 데이터가 일부 유실되더라도, 유실된 상태로 데이터를 처리해버린다.  
3방향 핸드셰이크가 없으며,  
첫 데이터는 리소스 확보를 위해 인터럽트를 거는 용도로 사용되고 버려진다.  

 
&nbsp;

연결 확립은 TCP 프로토콜,  
실제 데이터 전송은 UDP를 사용하는 경우가 대부분이다.
 
&nbsp;
 
Q. 넷플릭스나 유튜브 스트리밍 처럼 라방, 생방이 아닐 때도 UDP를 쓰나요?
A. 그런 경우는 TCP를 사용한다. 
단, 일정 단위의 동영상 데이터를 캐시에 미리 저장해 놓고 사용하여  
네트워크에 문제가 발생하더라도 영상이 곧바로 끊기지 않도록 한다.
 
&nbsp;
 



Q. 스타크래프트 1의 UDP 접속은 뭘까?
 
&nbsp;
||TCP|UDP|
|--:|:--:|:--:|
|지향점| 연결 지향<br>*Connection Oriented* | 비연결형<br>*Connectionless*|
|오류 제어|O
|흐름 제어|O
||유니캐스트|유 / 멀 / 브|
||전이중|반이중
||데이터 전송|실시간 트래픽 전송|
 
&nbsp;
 
 
&nbsp;
 
 

### [로드 밸런서]()

### 방화벽
장비를 통과하려는 트래픽의 통과 여부를 결정하는 장비.  

- 넓은 의미로는 네트워크 보안을 제공하는 모든 장비를 가리킨다. 
- 좁은 의미로는 3 / 4계층에서 SPI 엔진을 기반으로 동작하는 장비를 가리킨다.

"세션 테이블을 이용해 패킷의 인과관계를 파악한다."
인과관계가 뭘 가리키는 거야?

&nbsp;



&nbsp;
  

## **관련 개념**
[MSS]
(인캡슐레이션-디캡슐레이션.md)